<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI æ˜Ÿç›˜å åœ Pro - æ´æ‚‰çµé­‚è“å›¾</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* ==================== 
           CSS å˜é‡ä¸åŸºç¡€é‡ç½® 
           ==================== */
        :root {
            --gold: #FFD700;
            --purple-deep: #240b36;
            --purple-light: #c31432;
            --glass-bg: rgba(20, 20, 30, 0.65);
            --glass-border: 1px solid rgba(255, 255, 255, 0.15);
            --neon-glow: 0 0 10px rgba(255, 215, 0, 0.5);
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: 'Roboto', sans-serif;
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            transition: background-image 1s ease;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* --- åŠ¨æ€èƒŒæ™¯æ¨¡å¼ --- */
        /* å¤œæ™šæ¨¡å¼ (é»˜è®¤): æ·±ç©º */
        body.night-mode {
            background-image: 
                linear-gradient(to bottom, rgba(15, 12, 41, 0.8), rgba(48, 43, 99, 0.7), rgba(36, 36, 62, 0.8)),
                url('https://images.unsplash.com/photo-1464802686167-b93944301adf?q=80&w=2069&auto=format&fit=crop');
        }
        
        /* ç™½å¤©æ¨¡å¼: ç´«è‰²äº‘å±‚ */
        body.day-mode {
            background-image: 
                linear-gradient(to bottom, rgba(78, 84, 200, 0.6), rgba(143, 148, 251, 0.6)),
                url('https://images.pexels.com/photos/1287142/pexels-photo-1287142.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
        }

        /* æ˜Ÿæ˜ŸåŠ¨ç”»å®¹å™¨ */
        .stars-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; z-index: 0;
            background: transparent;
        }
        .star {
            position: absolute; background: white; border-radius: 50%;
            animation: twinkle var(--duration) ease-in-out infinite;
        }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }

        /* --- å¸ƒå±€å®¹å™¨ --- */
        .container {
            width: 90%; max-width: 650px;
            margin: 40px auto; padding-bottom: 80px;
            text-align: center; z-index: 2; position: relative;
        }

        h1, h2, h3 { font-family: 'Playfair Display', serif; }
        
        h1 {
            font-size: 2.4rem; margin-bottom: 10px;
            background: linear-gradient(to right, #fff, var(--gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(157, 78, 221, 0.5);
        }

        .subtitle { color: rgba(255,255,255,0.8); margin-bottom: 30px; font-weight: 300; letter-spacing: 1px; }

        /* --- å¡ç‰‡é€šç”¨æ ·å¼ --- */
        .glass-card {
            background: var(--glass-bg);
            backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px);
            border: var(--glass-border); border-radius: 16px;
            padding: 30px; margin-bottom: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5);
        }

        /* --- è¡¨å•æ ·å¼ --- */
        .input-group { text-align: left; margin-bottom: 15px; }
        label { color: var(--gold); font-size: 0.85rem; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 1px;}
        input {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 8px;
            color: #fff; font-size: 1rem; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--gold); box-shadow: 0 0 8px rgba(255, 215, 0, 0.2); }

        .btn-main {
            width: 100%; padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none; border-radius: 50px;
            color: white; font-size: 1.1rem; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 15px rgba(0,0,0,0.3); transition: transform 0.2s;
        }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(118, 75, 162, 0.5); }
        .btn-ghost { background: transparent; border: 1px solid rgba(255,255,255,0.3); margin-top: 15px; }

        /* --- æ˜Ÿç›˜è½®ç›˜å¯è§†åŒ– (æ ¸å¿ƒå‡çº§) --- */
        .chart-container {
            width: 280px; height: 280px; margin: 0 auto 30px auto;
            position: relative;
        }
        /* SVG æ—‹è½¬åŠ¨ç”» */
        .zodiac-wheel {
            width: 100%; height: 100%;
            animation: slow-rotate 120s linear infinite;
        }
        @keyframes slow-rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* è¡Œæ˜Ÿå®šä½å±‚ - ä¸éšè½®ç›˜æ—‹è½¬ï¼Œè€Œæ˜¯æ ¹æ®åº¦æ•°å®šä½ */
        .planet-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; /* è®©é¼ æ ‡èƒ½ç©¿é€ç‚¹å‡»ä¸‹é¢çš„å…ƒç´  */
        }
        
        .planet-marker {
            position: absolute; top: 50%; left: 50%;
            width: 2px; height: 50%; /* åŠå¾„é•¿åº¦ */
            transform-origin: top center; /* ä»¥ä¸­å¿ƒæ—‹è½¬ */
            pointer-events: none;
        }
        
        .planet-icon {
            position: absolute; bottom: 0; left: -12px;
            width: 24px; height: 24px;
            background: #fff; border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-size: 14px; color: #000; font-weight: bold;
            box-shadow: 0 0 10px rgba(255,255,255,0.8);
            cursor: pointer; pointer-events: auto; /* æ¢å¤äº¤äº’ */
            transition: transform 0.3s;
        }
        .planet-icon.sun { background: var(--gold); box-shadow: 0 0 15px var(--gold); }
        .planet-icon.moon { background: #E0E0E0; }
        .planet-icon.rising { background: #9d4edd; color: #fff; border: 1px solid #fff;}

        /* Tooltip */
        .tooltip {
            position: absolute; bottom: 35px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); padding: 8px 12px; border-radius: 6px;
            font-size: 0.75rem; color: #fff; white-space: nowrap; opacity: 0;
            transition: opacity 0.3s; pointer-events: none; border: 1px solid var(--gold);
            z-index: 10;
        }
        .planet-icon:hover .tooltip { opacity: 1; }
        .planet-icon:hover { transform: scale(1.3); z-index: 20; }

        /* --- ç»“æœå±•ç¤º --- */
        #result-section { display: none; opacity: 0; transition: opacity 0.8s ease; }
        .fade-in { opacity: 1 !important; }

        .astro-row {
            display: flex; align-items: center; margin-bottom: 15px;
            background: rgba(255,255,255,0.05); padding: 15px; border-radius: 10px;
            border-left: 3px solid var(--gold); text-align: left;
        }
        .astro-icon { font-size: 2rem; margin-right: 15px; width: 40px; text-align: center; }
        .astro-content h4 { color: var(--gold); margin-bottom: 4px; }
        .astro-content p { font-size: 0.9rem; color: #ddd; line-height: 1.4; }

        /* --- Premium åŒºåŸŸ --- */
        .premium-gate {
            position: relative; overflow: hidden;
            background: linear-gradient(135deg, #1a1a2e, #16213e);
            border: 1px solid #e94560;
        }
        .blur-content { filter: blur(6px); user-select: none; opacity: 0.6; }
        
        .premium-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.6); z-index: 5;
        }
        
        .btn-unlock {
            background: linear-gradient(45deg, #FF512F, #DD2476);
            border: none; padding: 12px 30px; color: white; border-radius: 30px;
            font-weight: bold; font-size: 1rem; cursor: pointer;
            animation: pulse 2s infinite; margin-top: 10px;
        }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(221, 36, 118, 0.7); } 70% { box-shadow: 0 0 0 10px rgba(221, 36, 118, 0); } 100% { box-shadow: 0 0 0 0 rgba(221, 36, 118, 0); } }

        /* Premium è§£é”å */
        #premium-content { display: none; margin-top: 20px; }
        
        .compatibility-form {
            background: rgba(255,255,255,0.1); padding: 15px; border-radius: 10px; margin-top: 15px;
        }
        
        /* Loading */
        .loader {
            display: none; border: 3px solid rgba(255,255,255,0.1); border-top: 3px solid var(--gold);
            border-radius: 50%; width: 40px; height: 40px; animation: spin 1s linear infinite; margin: 20px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ç§»åŠ¨ç«¯é€‚é… */
        @media (max-width: 480px) {
            .container { width: 95%; margin-top: 20px; }
            h1 { font-size: 1.8rem; }
        }
    </style>
</head>
<body>

    <div class="stars-overlay" id="stars-container"></div>

    <div class="container">
        <header id="header-area">
            <h1>AI æ˜Ÿç›˜å åœ Pro</h1>
            <p class="subtitle">è¿æ¥å®‡å®™ API Â· è§£é”ç”Ÿå‘½å¯†ç </p>
        </header>

        <div class="glass-card" id="input-card">
            <h3 style="margin-bottom: 20px; color: #ddd;">è¾“å…¥ä½ çš„å‡ºç”Ÿä¿¡æ¯</h3>
            <form id="astro-form">
                <div class="input-group">
                    <label>å§“å</label>
                    <input type="text" id="username" placeholder="ä½ çš„åå­—">
                </div>
                <div class="input-group">
                    <label>å‡ºç”Ÿæ—¥æœŸ (å¿…å¡«)</label>
                    <input type="date" id="birthdate" required>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="input-group" style="flex:1">
                        <label>å‡ºç”Ÿæ—¶é—´</label>
                        <input type="time" id="birthtime">
                    </div>
                    <div class="input-group" style="flex:1">
                        <label>å‡ºç”ŸåŸå¸‚</label>
                        <input type="text" id="city" placeholder="ä¾‹å¦‚: ä¸Šæµ·">
                    </div>
                </div>
                <p style="font-size: 0.7rem; color: #aaa; margin-bottom: 15px; text-align: left;">
                    * å‡ºç”Ÿæ—¶é—´è¶Šç²¾ç¡®ï¼Œä¸Šå‡æ˜Ÿåº§å’Œå®«ä½è®¡ç®—è¶Šå‡†ç¡®ã€‚
                </p>
                <button type="submit" class="btn-main">âœ¨ è¿çº¿å®‡å®™æ•°æ®åº“ âœ¨</button>
            </form>
            <div class="loader" id="loader"></div>
        </div>

        <div id="result-section">
            
            <h2 style="color: var(--gold); margin-bottom: 20px;">ğŸ”® <span id="res-name"></span> çš„æ˜Ÿç›˜æŠ¥å‘Š</h2>

            <div class="glass-card" style="padding: 10px;">
                <div class="chart-container">
                    <svg class="zodiac-wheel" viewBox="0 0 100 100">
                        <circle cx="50" cy="50" r="48" stroke="#ffffff" stroke-width="0.5" fill="none" opacity="0.3"/>
                        <circle cx="50" cy="50" r="35" stroke="#9d4edd" stroke-width="0.2" fill="none" opacity="0.2"/>
                        <line x1="50" y1="2" x2="50" y2="98" stroke="white" opacity="0.2" />
                        <line x1="2" y1="50" x2="98" y2="50" stroke="white" opacity="0.2" />
                        <line x1="26" y1="8.5" x2="74" y2="91.5" stroke="white" opacity="0.2" /> <line x1="74" y1="8.5" x2="26" y2="91.5" stroke="white" opacity="0.2" /> <line x1="8.5" y1="26" x2="91.5" y2="74" stroke="white" opacity="0.2" /> <line x1="8.5" y1="74" x2="91.5" y2="26" stroke="white" opacity="0.2" /> </svg>

                    <div class="planet-layer" id="planet-layer">
                        </div>
                </div>
                <p style="font-size: 0.8rem; color: #aaa;">é¼ æ ‡æ‚¬åœå›¾æ ‡æŸ¥çœ‹ç›¸ä½è¯¦æƒ…</p>
            </div>

            <div class="glass-card" id="basic-report">
                <h3 style="margin-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 10px;">åŸºç¡€è§£è¯»</h3>
                <div class="astro-row">
                    <div class="astro-icon">â˜€ï¸</div>
                    <div class="astro-content">
                        <h4 id="txt-sun">å¤ªé˜³ï¼š--</h4>
                        <p id="desc-sun">åŠ è½½ä¸­...</p>
                    </div>
                </div>
                <div class="astro-row">
                    <div class="astro-icon">ğŸŒ™</div>
                    <div class="astro-content">
                        <h4 id="txt-moon">æœˆäº®ï¼š--</h4>
                        <p id="desc-moon">éœ€ç²¾ç¡®æ—¶é—´...</p>
                    </div>
                </div>
                <div class="astro-row">
                    <div class="astro-icon">ğŸ¹</div>
                    <div class="astro-content">
                        <h4 id="txt-rising">ä¸Šå‡ï¼š--</h4>
                        <p id="desc-rising">éœ€ç²¾ç¡®æ—¶é—´...</p>
                    </div>
                </div>
            </div>

            <div class="glass-card premium-gate" id="premium-gate">
                <div class="premium-overlay" id="premium-overlay">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”’</div>
                    <h3>å‡çº§ Premium è§£é”å®Œæ•´å‘½è¿</h3>
                    <ul style="text-align: left; font-size: 0.9rem; color: #ddd; margin: 15px 0;">
                        <li>ğŸŒ¸ 2026 æ¡ƒèŠ±/æ­£ç¼˜è¯¦ç»†é¢„æµ‹</li>
                        <li>ğŸ’‘ åŒäººåˆç›˜å…¼å®¹æ€§æµ‹è¯•</li>
                        <li>ğŸ“… æœªæ¥12ä¸ªæœˆè¿åŠ¿æµå¹´</li>
                        <li>ğŸ“„ ä¸‹è½½ PDF å®Œæ•´æŠ¥å‘Š</li>
                    </ul>
                    <button class="btn-unlock" onclick="handlePayment()">ç«‹å³è§£é” (ï¿¥19.9)</button>
                </div>

                <div class="blur-content">
                    <h3>2026 æ¡ƒèŠ±è¿åŠ¿</h3>
                    <p>ä½ çš„æ­£ç¼˜å°†åœ¨ä»Šå¹´...</p>
                    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit.</p>
                    <h3>å…¼å®¹æ€§æµ‹è¯•</h3>
                </div>

                <div id="premium-content">
                    <div style="border-bottom: 1px solid rgba(255,255,255,0.2); padding-bottom: 15px; margin-bottom: 15px;">
                        <h3 style="color: #ff6b6b;">ğŸŒ¸ 2026 æ¡ƒèŠ±è¿ä¸“ç¯‡</h3>
                        <p id="premium-love-text" style="font-size: 0.95rem; line-height: 1.6; margin-top: 10px; text-align: left;">
                            </p>
                    </div>

                    <div style="margin-bottom: 20px;">
                        <h3 style="color: #4ecdc4;">ğŸ’‘ å…¼å®¹æ€§æµ‹è¯•</h3>
                        <div class="compatibility-form">
                            <input type="date" id="partner-dob" style="margin-bottom: 10px;">
                            <button class="btn-main" style="padding: 8px; font-size: 0.9rem;" onclick="checkCompatibility()">å¼€å§‹æ¯”å¯¹</button>
                            <div id="comp-result" style="margin-top: 10px; font-weight: bold; color: var(--gold);"></div>
                        </div>
                    </div>

                    <button class="btn-main btn-ghost" onclick="generatePDF()">ğŸ“¥ ä¸‹è½½ PDF å®Œæ•´æŠ¥å‘Š</button>
                </div>
            </div>

            <button class="btn-main btn-ghost" onclick="resetForm()">ğŸ”„ å†æµ‹ä¸€æ¬¡</button>
        </div>

        <footer style="margin-top: 40px; font-size: 0.7rem; color: rgba(255,255,255,0.4);">
            <p>æœ¬ç½‘ç«™ä»…ä¾›å¨±ä¹å‚è€ƒï¼Œéä¸“ä¸šé¢„æµ‹ã€‚<br>Mock API Mode Active.</p>
        </footer>
    </div>

    <script>
        // --- é…ç½®ä¸å¸¸é‡ ---
        const USE_REAL_API = false; // âš ï¸ æ”¹ä¸º true å¹¶å¡«å†™ä¸‹æ–¹ Key å¯ç”¨çœŸå®è¯·æ±‚
        const API_KEY = 'YOUR_API_KEY_HERE'; 
        const API_ENDPOINT = 'https://api.astrologyapi.com/v1/natal_chart'; // ç¤ºä¾‹ç«¯ç‚¹

        // æ˜Ÿåº§åŸºç¡€æ•°æ®
        const ZODIAC = [
            { name: "ç™½ç¾Šåº§", dates: [321, 419], desc: "çƒ­æƒ…å¦‚ç«ï¼Œè¡ŒåŠ¨åŠ›æå¼ºï¼Œæ˜¯å¤©ç”Ÿçš„å¼€æ‹“è€…ã€‚" },
            { name: "é‡‘ç‰›åº§", dates: [420, 520], desc: "ç¨³é‡åŠ¡å®ï¼Œå¯¹ç¾ä¸ç‰©è´¨æœ‰æé«˜çš„é‰´èµåŠ›ã€‚" },
            { name: "åŒå­åº§", dates: [521, 621], desc: "æ€ç»´æ•æ·ï¼Œæ²Ÿé€šèƒ½åŠ›å¼ºï¼Œæ‹¥æœ‰æœ‰è¶£çš„çµé­‚ã€‚" },
            { name: "å·¨èŸ¹åº§", dates: [622, 722], desc: "æ¸©æŸ”ä½“è´´ï¼Œå®¶åº­è§‚å¿µé‡ï¼Œæƒ…æ„Ÿç»†è…»ä¸°å¯Œã€‚" },
            { name: "ç‹®å­åº§", dates: [723, 822], desc: "è‡ªä¿¡å¤§æ–¹ï¼Œå…·æœ‰ç‹è€…é£èŒƒï¼Œæ¸´æœ›æˆä¸ºç„¦ç‚¹ã€‚" },
            { name: "å¤„å¥³åº§", dates: [823, 922], desc: "è¿½æ±‚å®Œç¾ï¼Œç»†è‡´å…¥å¾®ï¼Œé€»è¾‘æ€ç»´ä¸¥å¯†ã€‚" },
            { name: "å¤©ç§¤åº§", dates: [923, 1023], desc: "ä¼˜é›…è¿·äººï¼Œè¿½æ±‚å¹³è¡¡ä¸å’Œè°ï¼Œç¤¾äº¤é«˜æ‰‹ã€‚" },
            { name: "å¤©èåº§", dates: [1024, 1122], desc: "ç¥ç§˜æ·±æ²‰ï¼Œç›´è§‰æ•é”ï¼Œæ„å¿—åŠ›åšå®šä¸ç§»ã€‚" },
            { name: "å°„æ‰‹åº§", dates: [1123, 1221], desc: "ä¹è§‚å¼€æœ—ï¼Œå´‡å°šè‡ªç”±ï¼Œçƒ­çˆ±å†’é™©ä¸çœŸç†ã€‚" },
            { name: "æ‘©ç¾¯åº§", dates: [1222, 119], desc: "åšéŸ§ä¸æ‹”ï¼Œç›®æ ‡æ˜ç¡®ï¼Œæ˜¯ç°å®ä¸»ä¹‰çš„æ”€ç™»è€…ã€‚" }, // å¤„ç†è·¨å¹´é€»è¾‘éœ€ç‰¹æ®Š
            { name: "æ°´ç“¶åº§", dates: [120, 218], desc: "ç‹¬ç«‹ç‹¬ç‰¹ï¼Œæ€ç»´è¶…å‰ï¼Œå¯Œæœ‰äººé“ä¸»ä¹‰ç²¾ç¥ã€‚" },
            { name: "åŒé±¼åº§", dates: [219, 320], desc: "æµªæ¼«å¤šæƒ…ï¼Œæƒ³è±¡åŠ›ä¸°å¯Œï¼Œæå…·åŒç†å¿ƒã€‚" }
        ];

        // å…¨å±€çŠ¶æ€
        let currentData = {
            name: '',
            sun: {},
            moon: {},
            rising: {},
            dateStr: ''
        };

        // --- 1. åˆå§‹åŒ–ä¸èƒŒæ™¯ ---
        window.addEventListener('load', () => {
            setTheme();
            createStars();
        });

        function setTheme() {
            const h = new Date().getHours();
            document.body.className = (h >= 6 && h < 18) ? 'day-mode' : 'night-mode';
        }

        function createStars() {
            const container = document.getElementById('stars-container');
            for(let i=0; i<80; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                s.style.left = Math.random()*100 + '%';
                s.style.top = Math.random()*100 + '%';
                s.style.width = Math.random()*2 + 1 + 'px';
                s.style.height = s.style.width;
                s.style.setProperty('--duration', (Math.random()*3 + 2) + 's');
                container.appendChild(s);
            }
        }

        // --- 2. æ ¸å¿ƒé€»è¾‘ï¼šè·å–æ•°æ® (API æˆ– Mock) ---
        async function handleFormSubmit(e) {
            e.preventDefault();
            const form = document.getElementById('astro-form');
            const name = document.getElementById('username').value || "æ—…è¡Œè€…";
            const dateVal = document.getElementById('birthdate').value;
            const timeVal = document.getElementById('birthtime').value;
            const city = document.getElementById('city').value;

            if(!dateVal) return alert("è¯·é€‰æ‹©å‡ºç”Ÿæ—¥æœŸ");

            // UI Loading
            document.getElementById('loader').style.display = 'block';
            document.querySelector('.btn-main').style.display = 'none';

            try {
                let result;
                if (USE_REAL_API && API_KEY !== 'YOUR_API_KEY_HERE') {
                    // --- çœŸå® API è·¯å¾„ (ç¤ºä¾‹ç»“æ„) ---
                    // æ³¨æ„ï¼šçœŸå®åœºæ™¯éœ€è¦å¤„ç†ç»çº¬åº¦è½¬æ¢ (Geocoding)
                    // è¿™é‡Œä»…æ¼”ç¤º fetch ç»“æ„
                    /* const response = await fetch(API_ENDPOINT, {
                        method: 'POST',
                        headers: { 'Authorization': 'Basic ' + btoa(API_ID+':'+API_KEY) },
                        body: JSON.stringify({ day, month, year, hour, min, lat, lon, tzone })
                    });
                    result = await response.json(); 
                    */
                   throw new Error("APIæœªé…ç½®ï¼Œè½¬å…¥Mock"); // æ¼”ç¤ºç”¨ï¼Œå¼ºåˆ¶è·³è¿‡
                } else {
                    // --- Mock è·¯å¾„ (æœ¬åœ°è®¡ç®— + éšæœºæ¨¡æ‹Ÿ) ---
                    await new Promise(r => setTimeout(r, 1200)); // å‡è£…ç½‘ç»œå»¶è¿Ÿ
                    result = calculateMockData(dateVal, timeVal, city);
                }

                // æ›´æ–°å…¨å±€çŠ¶æ€
                currentData.name = name;
                currentData.dateStr = dateVal;
                currentData.sun = result.sun;
                currentData.moon = result.moon;
                currentData.rising = result.rising;

                renderResult();

            } catch (err) {
                console.error(err);
                alert("è¿æ¥å®‡å®™ä¿¡å·å¤±è´¥ï¼Œè¯·ç¨åé‡è¯•ã€‚");
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        }

        // --- æœ¬åœ°æ¨¡æ‹Ÿç®—æ³• ---
        function calculateMockData(dateStr, timeStr, city) {
            const date = new Date(dateStr);
            const m = date.getMonth() + 1;
            const d = date.getDate();
            const md = m * 100 + d;

            // 1. å¤ªé˜³æ˜Ÿåº§ (å‡†ç¡®)
            let sunSign = ZODIAC.find(z => z.name === "æ‘©ç¾¯åº§"); // Default
            for(let z of ZODIAC) {
                if(z.name !== "æ‘©ç¾¯åº§") {
                    if(md >= z.dates[0] && md <= z.dates[1]) sunSign = z;
                } else {
                    if(md >= 1222 || md <= 119) sunSign = z;
                }
            }
            
            // 2. æœˆäº®/ä¸Šå‡ (åŸºäºå“ˆå¸Œçš„ä¼ªéšæœºï¼Œä¿è¯åŒä¸€æ—¶é—´è¾“å…¥ç»“æœä¸€è‡´)
            // å¦‚æœæ²¡å¡«æ—¶é—´ï¼Œç»™ä¸€ä¸ªéšæœºå€¼
            const seed = dateStr + (timeStr || "12:00") + (city || "Default");
            const hash = seed.split('').reduce((a,b)=>a+b.charCodeAt(0),0);
            
            const moonIndex = (hash + 2) % 12;
            const risingIndex = (hash + 7) % 12;

            // æ¨¡æ‹Ÿåº¦æ•° (0-360) ç”¨äºSVGæ˜¾ç¤º
            const sunDeg = getDegree(sunSign.name); // ç®€åŒ–ï¼šç›´æ¥å–æ˜Ÿåº§ä¸­é—´åº¦æ•°
            const moonDeg = Math.random() * 360; 
            const risingDeg = Math.random() * 360;

            return {
                sun: { ...sunSign, degree: sunDeg },
                moon: { ...ZODIAC[moonIndex], degree: moonDeg },
                rising: { ...ZODIAC[risingIndex], degree: risingDeg }
            };
        }

        function getDegree(signName) {
            const idx = ZODIAC.findIndex(z => z.name === signName);
            // æ¯ä¸ªæ˜Ÿåº§30åº¦ï¼Œå–ä¸­é—´15åº¦
            // ç™½ç¾Šåº§ä»0åº¦å¼€å§‹
            // ä¿®æ­£é¡ºåºï¼šç™½ç¾Š(0), é‡‘ç‰›(1)...
            // ZODIAC æ•°ç»„é¡ºåºå¹¶ä¸æ˜¯æ ‡å‡†çš„ 0-11 é¡ºåº (æ‘©ç¾¯åœ¨ä¸­é—´)ï¼Œè¿™é‡Œç®€å•å¤„ç†ï¼š
            const standardOrder = ["ç™½ç¾Šåº§","é‡‘ç‰›åº§","åŒå­åº§","å·¨èŸ¹åº§","ç‹®å­åº§","å¤„å¥³åº§","å¤©ç§¤åº§","å¤©èåº§","å°„æ‰‹åº§","æ‘©ç¾¯åº§","æ°´ç“¶åº§","åŒé±¼åº§"];
            const realIdx = standardOrder.indexOf(signName);
            return realIdx * 30 + 15;
        }


        // --- 3. æ¸²æŸ“ç»“æœ ---
        function renderResult() {
            // éšè—è¡¨å•ï¼Œæ˜¾ç¤ºç»“æœ
            document.getElementById('input-card').style.display = 'none';
            const resSec = document.getElementById('result-section');
            resSec.style.display = 'block';
            
            // åå­—
            document.getElementById('res-name').innerText = currentData.name;

            // åŸºç¡€æ–‡æœ¬
            document.getElementById('txt-sun').innerText = `å¤ªé˜³ in ${currentData.sun.name}`;
            document.getElementById('desc-sun').innerText = currentData.sun.desc;

            document.getElementById('txt-moon').innerText = `æœˆäº® in ${currentData.moon.name}`;
            document.getElementById('desc-moon').innerText = `å†…åœ¨å®‰å…¨æ„Ÿæ¥æºã€‚${currentData.moon.desc}`;

            document.getElementById('txt-rising').innerText = `ä¸Šå‡ in ${currentData.rising.name}`;
            document.getElementById('desc-rising').innerText = `ç»™ä»–äººçš„ç¬¬ä¸€å°è±¡ã€‚${currentData.rising.desc}`;

            // æ¸²æŸ“è¡Œæ˜Ÿåœ¨è½®ç›˜ä¸Šçš„ä½ç½®
            const layer = document.getElementById('planet-layer');
            layer.innerHTML = ''; // æ¸…ç©º
            
            // æ·»åŠ è¡Œæ˜Ÿå›¾æ ‡
            addPlanetToWheel(layer, 'sun', 'â˜€ï¸', currentData.sun.degree, currentData.sun.name);
            addPlanetToWheel(layer, 'moon', 'ğŸŒ™', currentData.moon.degree, currentData.moon.name);
            addPlanetToWheel(layer, 'rising', 'ğŸ¹', currentData.rising.degree, currentData.rising.name);

            // æ·¡å…¥åŠ¨ç”»
            setTimeout(() => resSec.classList.add('fade-in'), 50);
        }

        function addPlanetToWheel(container, type, icon, degree, signName) {
            // åˆ›å»ºæ—‹è½¬è‡‚
            const marker = document.createElement('div');
            marker.className = 'planet-marker';
            // æ—‹è½¬è§’åº¦ï¼šSVG 0åº¦é€šå¸¸åœ¨3ç‚¹é’Ÿæˆ–12ç‚¹é’Ÿæ–¹å‘ï¼Œè¿™é‡Œå‡è®¾12ç‚¹ä¸º0åº¦
            marker.style.transform = `rotate(${degree}deg)`;

            // åˆ›å»ºå›¾æ ‡
            const iconDiv = document.createElement('div');
            iconDiv.className = `planet-icon ${type}`;
            iconDiv.innerHTML = icon;
            // å›¾æ ‡åå‘æ—‹è½¬ä»¥ä¿æŒç›´ç«‹ (å¯é€‰ï¼Œè¿™é‡Œä¸åè½¬è®©å®ƒéšè½®ç›˜è½¬æ›´æœ‰è¶£ï¼Œæˆ–è€…åè½¬ä¿æŒæ­£å‘)
            iconDiv.style.transform = `rotate(-${degree}deg)`; 

            // Tooltip
            const tip = document.createElement('div');
            tip.className = 'tooltip';
            tip.innerText = `${type === 'sun' ? 'å¤ªé˜³' : type === 'moon' ? 'æœˆäº®' : 'ä¸Šå‡'} in ${signName} (${Math.floor(degree)}Â°)`;
            
            iconDiv.appendChild(tip);
            marker.appendChild(iconDiv);
            container.appendChild(marker);
        }

        // --- 4. Premium åŠŸèƒ½ ---
        function handlePayment() {
            // æ¨¡æ‹Ÿæ”¯ä»˜
            if(confirm("æ­£åœ¨è¿æ¥ Stripe æ”¯ä»˜ç½‘å…³...\n(æ¨¡æ‹Ÿï¼šæ”¯ä»˜ 19.9 å…ƒè§£é”)")) {
                unlockPremium();
            }
        }

        function unlockPremium() {
            const overlay = document.getElementById('premium-overlay');
            const blurContent = document.querySelector('.blur-content');
            const realContent = document.getElementById('premium-content');

            overlay.style.display = 'none';
            blurContent.style.display = 'none';
            realContent.style.display = 'block';

            // ç”Ÿæˆæ¡ƒèŠ±è¿æ–‡æ¡ˆ
            const loveText = `äº²çˆ±çš„${currentData.name}ï¼ŒåŸºäºä½ çš„é‡‘æ˜Ÿä¸${currentData.sun.name}èƒ½é‡ï¼Œ2026å¹´ä½ çš„æ¡ƒèŠ±è¿åŠ¿å°†åœ¨**5æœˆå’Œ11æœˆ**è¾¾åˆ°é¡¶å³°ã€‚ä½ çš„æ­£ç¼˜å¯èƒ½å…·æœ‰${currentData.rising.name}çš„ç‰¹è´¨ï¼Œæ¯”å¦‚${currentData.rising.desc.substring(0,6)}... \n\nå»ºè®®ï¼šå¤šç•™æ„èŒåœºæˆ–å­¦ä¹ åœºæ‰€çš„ç›¸é‡ã€‚`;
            document.getElementById('premium-love-text').innerText = loveText;
        }

        function checkCompatibility() {
            const pDate = document.getElementById('partner-dob').value;
            if(!pDate) return alert("è¯·è¾“å…¥å¯¹æ–¹ç”Ÿæ—¥");
            
            const scores = [78, 85, 92, 65, 40, 98];
            const score = scores[Math.floor(Math.random()*scores.length)];
            const text = score > 80 ? "å¤©ä½œä¹‹åˆï¼çµé­‚å…±é¸£æå¼ºã€‚" : score > 60 ? "æ¬¢å–œå†¤å®¶ï¼Œéœ€è¦å¤šæ²Ÿé€šã€‚" : "æŒ‘æˆ˜å¾ˆå¤§ï¼Œä½†çœŸçˆ±æ— æ•Œã€‚";
            
            document.getElementById('comp-result').innerHTML = `åŒ¹é…åº¦ï¼š<span style="font-size:1.2rem; color:#ff6b6b">${score}%</span><br>${text}`;
        }

        // --- 5. PDF ç”Ÿæˆ ---
        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();

            // è®¾ç½®å­—ä½“ (jsPDFé»˜è®¤ä¸æ”¯æŒä¸­æ–‡ï¼Œéœ€è¦è‡ªå®šä¹‰å­—ä½“ï¼Œè¿™é‡Œä¸ºæ¼”ç¤ºç®€åŒ–ç”¨è‹±æ–‡æˆ–ç®€æ˜“å¤„ç†)
            // *çœŸå®ç”Ÿäº§ç¯å¢ƒéœ€å¼•å…¥ .ttf å­—ä½“æ–‡ä»¶æ”¯æŒä¸­æ–‡*
            // è¿™é‡Œä¸ºäº†ä»£ç å¯è¿è¡Œæ€§ï¼Œæˆ‘ä»¬ç”¨è‹±æ–‡è¾“å‡ºæˆ–è€…æç¤º
            
            doc.setFontSize(22);
            doc.text("Astro Report 2026", 20, 20);
            
            doc.setFontSize(16);
            doc.text(`Name: ${currentData.name || 'User'}`, 20, 40);
            
            doc.setFontSize(12);
            doc.text(`Sun Sign: ${currentData.sun.name}`, 20, 60);
            doc.text(`Moon Sign: ${currentData.moon.name}`, 20, 70);
            doc.text(`Rising Sign: ${currentData.rising.name}`, 20, 80);
            
            doc.text("Love Forecast (Premium):", 20, 100);
            const loveLines = doc.splitTextToSize("Your love luck peaks in May 2026. Look for someone grounded and stable.", 170);
            doc.text(loveLines, 20, 110);

            doc.save('my_astro_chart.pdf');
            alert("PDF ä¸‹è½½å·²å¼€å§‹ï¼(æ³¨ï¼šæ ‡å‡†ç‰ˆjsPDFä»…æ”¯æŒè‹±æ–‡å­—ç¬¦ï¼Œä¸­æ–‡éœ€åŠ è½½å­—ä½“æ–‡ä»¶)");
        }

        function resetForm() {
            document.getElementById('astro-form').reset();
            document.getElementById('result-section').style.display = 'none';
            document.getElementById('result-section').classList.remove('fade-in');
            document.getElementById('input-card').style.display = 'block';
            document.querySelector('.btn-main').style.display = 'block';
            
            // é‡ç½® Premium çŠ¶æ€
            document.getElementById('premium-overlay').style.display = 'flex';
            document.querySelector('.blur-content').style.display = 'block';
            document.getElementById('premium-content').style.display = 'none';
        }

        // ç»‘å®šäº‹ä»¶
        document.getElementById('astro-form').addEventListener('submit', handleFormSubmit);

    </script>
</body>
</html>
