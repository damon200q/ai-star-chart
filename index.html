<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ˜Ÿé­‚å åœ Â· æ­ç§˜ä½ çš„å®‡å®™è“å›¾</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;600;700&family=Noto+Serif+SC:wght@400;700&family=Playfair+Display:wght@700&family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
        /* ==================== CSS æ ¸å¿ƒæ ·å¼ ==================== */
        :root {
            --gold: #FFD700;
            --purple-deep: #1a0b2e;
            --glass-bg: rgba(20, 20, 35, 0.7);
            --glass-border: 1px solid rgba(255, 255, 255, 0.15);
            --accent-pink: #ff00cc;
            --font-en-serif: 'Cormorant Garamond', serif;
            --font-cn-serif: 'Noto Serif SC', serif;
            --font-sans: 'Roboto', sans-serif;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; }

        body {
            font-family: var(--font-sans);
            color: #fff;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-x: hidden;
            transition: background 1s ease;
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
        }

        /* å­—ä½“ç±»åˆ‡æ¢ */
        body.lang-cn .serif { font-family: var(--font-cn-serif); }
        body.lang-en .serif { font-family: var(--font-en-serif); letter-spacing: 1px; }

        /* --- åŠ¨æ€èƒŒæ™¯ --- */
        body.night-mode {
            background-image: linear-gradient(to bottom, rgba(15, 12, 41, 0.9), rgba(48, 43, 99, 0.8)), url('https://images.unsplash.com/photo-1534796636912-3b95b3ab5986?q=80&w=2072&auto=format&fit=crop');
        }
        body.day-mode {
            background-image: linear-gradient(to bottom, rgba(100, 65, 165, 0.7), rgba(42, 8, 69, 0.8)), url('https://images.pexels.com/photos/2098428/pexels-photo-2098428.jpeg?auto=compress&cs=tinysrgb&w=1260&h=750&dpr=1');
        }

        /* æ˜Ÿæ˜ŸåŠ¨ç”» */
        .stars-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 0; }
        .star { position: absolute; background: white; border-radius: 50%; animation: twinkle var(--duration) ease-in-out infinite; }
        @keyframes twinkle { 0%, 100% { opacity: 0.2; transform: scale(0.8); } 50% { opacity: 1; transform: scale(1.2); } }

        /* --- è¯­è¨€åˆ‡æ¢å™¨ --- */
        .lang-switch {
            position: absolute; top: 20px; right: 20px; z-index: 10;
        }
        .lang-btn {
            background: rgba(0,0,0,0.4); border: 1px solid rgba(255,255,255,0.3); color: #fff;
            padding: 5px 12px; border-radius: 20px; cursor: pointer; transition: 0.3s; font-size: 0.8rem;
        }
        .lang-btn:hover, .lang-btn.active { background: var(--gold); color: #000; border-color: var(--gold); }

        /* --- ä¸»å®¹å™¨ --- */
        .container {
            width: 90%; max-width: 600px; margin: 60px auto; padding-bottom: 80px;
            text-align: center; z-index: 2; position: relative;
        }

        h1 {
            font-size: 2.2rem; margin-bottom: 8px;
            background: linear-gradient(to right, #fff, #ffd700);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(157, 78, 221, 0.6);
        }
        .subtitle { font-size: 1rem; color: rgba(255,255,255,0.85); margin-bottom: 30px; font-weight: 300; }

        /* --- å¡ç‰‡æ ·å¼ --- */
        .glass-card {
            background: var(--glass-bg); backdrop-filter: blur(16px);
            border: var(--glass-border); border-radius: 16px; padding: 25px; margin-bottom: 25px;
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.5); transition: transform 0.3s;
        }
        
        /* è¡¨å•å…ƒç´  */
        .input-group { text-align: left; margin-bottom: 15px; }
        label { color: var(--gold); font-size: 0.8rem; margin-bottom: 5px; display: block; text-transform: uppercase; letter-spacing: 1px;}
        input {
            width: 100%; padding: 12px; background: rgba(0,0,0,0.3);
            border: 1px solid rgba(255,255,255,0.2); border-radius: 8px;
            color: #fff; font-size: 1rem; outline: none; transition: 0.3s;
        }
        input:focus { border-color: var(--gold); box-shadow: 0 0 10px rgba(255, 215, 0, 0.2); }

        .btn-main {
            width: 100%; padding: 14px; margin-top: 10px;
            background: linear-gradient(135deg, #333399 0%, #ff00cc 100%);
            border: none; border-radius: 50px; color: white; font-size: 1.1rem; font-weight: bold;
            cursor: pointer; box-shadow: 0 4px 15px rgba(255, 0, 204, 0.3); transition: 0.3s;
        }
        .btn-main:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 0, 204, 0.5); }

        /* --- æ˜Ÿç›˜ SVG å¯è§†åŒ– --- */
        .chart-wrapper {
            width: 300px; height: 300px; margin: 0 auto 30px auto; position: relative;
        }
        .zodiac-svg { width: 100%; height: 100%; animation: rotate-slow 120s linear infinite; }
        @keyframes rotate-slow { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }

        /* è¡Œæ˜Ÿå›¾æ ‡æ ·å¼ */
        .planet-marker {
            position: absolute; top: 50%; left: 50%; width: 2px; height: 50%; /* åŠå¾„ */
            transform-origin: top center; pointer-events: none;
        }
        .planet-icon {
            position: absolute; bottom: 0; left: -10px; width: 20px; height: 20px;
            background: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-size: 12px; cursor: pointer; pointer-events: auto;
            box-shadow: 0 0 8px rgba(255,255,255,0.8); transition: 0.3s;
        }
        .planet-icon:hover { transform: scale(1.5); z-index: 100; box-shadow: 0 0 15px var(--gold); }
        
        /* Tooltip */
        .astro-tooltip {
            position: absolute; bottom: 30px; left: 50%; transform: translateX(-50%);
            background: rgba(0,0,0,0.9); border: 1px solid var(--gold); padding: 8px 12px;
            border-radius: 6px; font-size: 0.8rem; color: #fff; width: 180px; text-align: center;
            opacity: 0; pointer-events: none; transition: opacity 0.3s; z-index: 200;
        }
        .planet-icon:hover .astro-tooltip { opacity: 1; }

        /* --- ç»“æœ & Premium --- */
        #result-section { display: none; opacity: 0; transition: opacity 1s; }
        .fade-in { opacity: 1 !important; }

        .premium-lock-area {
            position: relative; overflow: hidden; background: linear-gradient(135deg, #141E30, #243B55);
            border: 1px solid var(--accent-pink); padding: 0;
        }
        .blur-preview { filter: blur(8px); opacity: 0.5; padding: 20px; user-select: none; }
        .lock-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            background: rgba(0,0,0,0.6); z-index: 5;
        }
        
        .btn-premium {
            background: linear-gradient(45deg, #F7971E, #FFD200);
            color: #000; border: none; padding: 12px 30px; border-radius: 30px;
            font-weight: bold; cursor: pointer; animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.05); } 100% { transform: scale(1); } }

        /* å…¼å®¹æ€§æµ‹è¯•åŒº */
        .match-card { background: rgba(255,255,255,0.05); padding: 15px; margin-top: 15px; border-radius: 10px; }

        /* Loader */
        .loader {
            display: none; width: 40px; height: 40px; margin: 20px auto;
            border: 3px solid rgba(255,255,255,0.3); border-top: 3px solid var(--gold);
            border-radius: 50%; animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* ç§»åŠ¨ç«¯ */
        @media (max-width: 480px) { h1 { font-size: 1.8rem; } }
    </style>
</head>
<body class="lang-cn">

    <div class="stars-overlay" id="stars-container"></div>

    <div class="lang-switch">
        <button class="lang-btn active" onclick="changeLang('cn')">ä¸­æ–‡</button>
        <button class="lang-btn" onclick="changeLang('en')">EN</button>
    </div>

    <div class="container">
        <header>
            <h1 class="serif" id="i18n-title">æ˜Ÿé­‚å åœ Â· æ­ç§˜ä½ çš„å®‡å®™è“å›¾ âœ¨</h1>
            <p class="subtitle" id="i18n-subtitle">è¾“å…¥ç”Ÿæ—¥ï¼ŒAIè§£æä½ çš„çµé­‚Â·æ¡ƒèŠ±Â·å‘½è¿</p>
        </header>

        <div class="glass-card" id="input-card">
            <form id="astro-form">
                <div class="input-group">
                    <label id="lbl-name">ä½ çš„åå­—</label>
                    <input type="text" id="username" placeholder="Name">
                </div>
                <div class="input-group">
                    <label id="lbl-dob">å‡ºç”Ÿæ—¥æœŸ</label>
                    <input type="date" id="birthdate" required>
                </div>
                <div style="display: flex; gap: 10px;">
                    <div class="input-group" style="flex:1">
                        <label id="lbl-time">å‡ºç”Ÿæ—¶é—´ (é‡è¦)</label>
                        <input type="time" id="birthtime">
                    </div>
                    <div class="input-group" style="flex:1">
                        <label id="lbl-city">åŸå¸‚</label>
                        <input type="text" id="city" placeholder="City">
                    </div>
                </div>
                
                <button type="submit" class="btn-main" id="btn-submit">âœ¨ æ­å¼€å‘½è¿é¢çº± âœ¨</button>
            </form>
            <div class="loader" id="loader"></div>
        </div>

        <div id="result-section">
            <h2 class="serif" style="color: var(--gold); margin-bottom: 20px;">
                <span id="res-name-display"></span> <span id="i18n-report-title">çš„æ˜Ÿç›˜æŠ¥å‘Š</span>
            </h2>

            <div class="glass-card chart-wrapper">
                <svg id="zodiac-wheel" class="zodiac-svg" viewBox="0 0 200 200">
                    </svg>
                <div id="planet-layer"></div>
            </div>

            <div class="glass-card" style="text-align: left;">
                <div style="margin-bottom: 15px;">
                    <strong style="color: var(--gold); font-size: 1.1rem;">â˜€ï¸ <span id="lbl-sun">å¤ªé˜³</span>: </strong>
                    <span id="val-sun">--</span>
                    <p style="font-size: 0.9rem; color: #ccc; margin-top: 5px;" id="desc-sun">--</p>
                </div>
                <div style="margin-bottom: 15px;">
                    <strong style="color: var(--gold); font-size: 1.1rem;">ğŸŒ™ <span id="lbl-moon">æœˆäº®</span>: </strong>
                    <span id="val-moon">--</span>
                    <p style="font-size: 0.9rem; color: #ccc; margin-top: 5px;" id="desc-moon">--</p>
                </div>
                <div>
                    <strong style="color: var(--gold); font-size: 1.1rem;">ğŸ¹ <span id="lbl-rising">ä¸Šå‡</span>: </strong>
                    <span id="val-rising">--</span>
                    <p style="font-size: 0.9rem; color: #ccc; margin-top: 5px;" id="desc-rising">--</p>
                </div>
            </div>

            <div class="glass-card premium-lock-area">
                <div class="lock-overlay" id="lock-overlay">
                    <div style="font-size: 2rem; margin-bottom: 10px;">ğŸ”’</div>
                    <h3 id="i18n-premium-title">è§£é” Premium æ·±åº¦æŠ¥å‘Š</h3>
                    <p style="font-size: 0.8rem; opacity: 0.8; margin-bottom: 15px;" id="i18n-premium-subtitle">
                        åŒ…å«ï¼š2026 æ¡ƒèŠ±æ­£ç¼˜ Â· åŒäººåˆç›˜ Â· å®Œæ•´ PDF
                    </p>
                    <button class="btn-premium" onclick="unlockPremium()" id="btn-unlock">
                        ç«‹å³è§£é” (ï¿¥19.9)
                    </button>
                </div>

                <div class="blur-preview">
                    <h3>2026 LOVE FORECAST</h3>
                    <p>Lorem ipsum dolor sit amet...</p>
                    <p>Your soulmate is likely a Fire Sign...</p>
                </div>

                <div id="premium-content" style="display: none; padding: 20px; text-align: left;">
                    <h3 style="color: #ff00cc; margin-bottom: 10px;">ğŸŒ¸ <span id="i18n-love-title">2026 æ¡ƒèŠ±è¿åŠ¿</span></h3>
                    <div id="love-forecast-text" style="font-size: 0.9rem; line-height: 1.6; margin-bottom: 20px;"></div>

                    <div class="match-card">
                        <h4 style="color: var(--gold); margin-bottom: 10px;">ğŸ’‘ <span id="i18n-match-title">åŒäººåˆç›˜å…¼å®¹åº¦</span></h4>
                        <div style="display: flex; gap: 5px;">
                            <input type="date" id="partner-date">
                            <button class="btn-main" style="margin: 0; padding: 5px 15px; font-size: 0.8rem;" onclick="calcMatch()" id="btn-match">Match</button>
                        </div>
                        <div id="match-result" style="margin-top: 10px; font-weight: bold;"></div>
                    </div>

                    <button class="btn-main" style="background: transparent; border: 1px solid #fff; margin-top: 20px;" onclick="downloadPDF()">
                        ğŸ“¥ <span id="btn-pdf">ä¸‹è½½å®Œæ•´ PDF æŠ¥å‘Š</span>
                    </button>
                </div>
            </div>

            <p style="font-size: 0.7rem; color: #888; margin-top: 30px;" id="footer-text">
                ä»…ä¾›å¨±ä¹å‚è€ƒ Â· Mock Mode Active
            </p>
        </div>
    </div>

    <script>
        // --- é…ç½® ---
        const USE_REAL_API = false; // âš ï¸ æ”¹ä¸º true å¯ç”¨ fetch
        const API_KEY = 'YOUR_KEY_HERE'; // https://freeastrologyapi.com/ æ³¨å†Œ
        const API_URL = 'https://json.freeastrologyapi.com/planets';

        // --- i18n å­—å…¸ ---
        const TRANSLATIONS = {
            cn: {
                title: "æ˜Ÿé­‚å åœ Â· æ­ç§˜ä½ çš„å®‡å®™è“å›¾ âœ¨",
                subtitle: "è¾“å…¥ç”Ÿæ—¥ï¼ŒAIè§£æä½ çš„çµé­‚Â·æ¡ƒèŠ±Â·å‘½è¿",
                namePlaceholder: "ä½ çš„åå­—",
                lblDob: "å‡ºç”Ÿæ—¥æœŸ",
                lblTime: "å‡ºç”Ÿæ—¶é—´ (é‡è¦)",
                lblCity: "å‡ºç”ŸåŸå¸‚",
                btnSubmit: "âœ¨ æ­å¼€å‘½è¿é¢çº± âœ¨",
                reportTitle: "çš„æ˜Ÿç›˜æŠ¥å‘Š",
                sun: "å¤ªé˜³", moon: "æœˆäº®", rising: "ä¸Šå‡",
                premiumTitle: "è§£é” Premium æ·±åº¦æŠ¥å‘Š",
                premiumSubtitle: "åŒ…å«ï¼š2026 æ¡ƒèŠ±æ­£ç¼˜ Â· åŒäººåˆç›˜ Â· å®Œæ•´ PDF",
                btnUnlock: "ç«‹å³è§£é” (ï¿¥19.9)",
                loveTitle: "2026 æ¡ƒèŠ±è¿åŠ¿",
                matchTitle: "åŒäººåˆç›˜å…¼å®¹åº¦",
                btnMatch: "å¼€å§‹æ¯”å¯¹",
                btnPdf: "ä¸‹è½½å®Œæ•´ PDF æŠ¥å‘Š",
                footer: "ä»…ä¾›å¨±ä¹å‚è€ƒ Â· Mock Mode Active",
                zodiacNames: ["ç™½ç¾Šåº§", "é‡‘ç‰›åº§", "åŒå­åº§", "å·¨èŸ¹åº§", "ç‹®å­åº§", "å¤„å¥³åº§", "å¤©ç§¤åº§", "å¤©èåº§", "å°„æ‰‹åº§", "æ‘©ç¾¯åº§", "æ°´ç“¶åº§", "åŒé±¼åº§"]
            },
            en: {
                title: "Cosmic Soul Chart âœ¨ - Unlock Destiny",
                subtitle: "AI Analysis of your Soul, Love & Fate based on Birth Chart",
                namePlaceholder: "Your Name",
                lblDob: "Date of Birth",
                lblTime: "Birth Time (Crucial)",
                lblCity: "City of Birth",
                btnSubmit: "âœ¨ Reveal My Blueprint âœ¨",
                reportTitle: "'s Cosmic Report",
                sun: "Sun", moon: "Moon", rising: "Rising",
                premiumTitle: "Unlock Premium Insights",
                premiumSubtitle: "Incl: 2026 Love Forecast Â· Compatibility Â· Full PDF",
                btnUnlock: "Unlock Now ($2.99)",
                loveTitle: "2026 Love Forecast",
                matchTitle: "Soulmate Compatibility",
                btnMatch: "Check Match",
                btnPdf: "Download Full PDF Report",
                footer: "For entertainment only Â· Mock Mode Active",
                zodiacNames: ["Aries", "Taurus", "Gemini", "Cancer", "Leo", "Virgo", "Libra", "Scorpio", "Sagittarius", "Capricorn", "Aquarius", "Pisces"]
            }
        };

        // å½“å‰çŠ¶æ€
        let currentLang = 'cn';
        let userData = {};

        // --- åˆå§‹åŒ– ---
        window.addEventListener('load', () => {
            initStars();
            initTheme();
            drawSVGBg(); // ç»˜åˆ¶é™æ€ SVG è½®ç›˜
        });

        // 1. è¯­è¨€åˆ‡æ¢
        function changeLang(lang) {
            currentLang = lang;
            document.body.className = lang === 'cn' ? 'lang-cn' : 'lang-en';
            
            // æŒ‰é’®æ ·å¼
            document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');

            // æ–‡æœ¬æ›´æ–°
            const t = TRANSLATIONS[lang];
            document.getElementById('i18n-title').textContent = t.title;
            document.getElementById('i18n-subtitle').textContent = t.subtitle;
            document.getElementById('username').placeholder = t.namePlaceholder;
            document.getElementById('lbl-dob').textContent = t.lblDob;
            document.getElementById('lbl-time').textContent = t.lblTime;
            document.getElementById('lbl-city').textContent = t.lblCity;
            document.getElementById('btn-submit').textContent = t.btnSubmit;
            document.getElementById('i18n-report-title').textContent = t.reportTitle;
            document.getElementById('lbl-sun').textContent = t.sun;
            document.getElementById('lbl-moon').textContent = t.moon;
            document.getElementById('lbl-rising').textContent = t.rising;
            document.getElementById('i18n-premium-title').textContent = t.premiumTitle;
            document.getElementById('i18n-premium-subtitle').textContent = t.premiumSubtitle;
            document.getElementById('btn-unlock').textContent = t.btnUnlock;
            document.getElementById('i18n-love-title').textContent = t.loveTitle;
            document.getElementById('i18n-match-title').textContent = t.matchTitle;
            document.getElementById('btn-match').textContent = t.btnMatch;
            document.getElementById('btn-pdf').textContent = t.btnPdf;
            document.getElementById('footer-text').textContent = t.footer;
        }

        // 2. è§†è§‰æ•ˆæœåˆå§‹åŒ–
        function initStars() {
            const container = document.getElementById('stars-container');
            for(let i=0; i<60; i++) {
                const s = document.createElement('div');
                s.className = 'star';
                s.style.left = Math.random()*100 + '%';
                s.style.top = Math.random()*100 + '%';
                s.style.width = Math.random()*2 + 'px';
                s.style.height = s.style.width;
                s.style.setProperty('--duration', (Math.random()*3+2)+'s');
                container.appendChild(s);
            }
        }

        function initTheme() {
            const h = new Date().getHours();
            if(h >= 6 && h < 18) document.body.classList.add('day-mode');
            else document.body.classList.add('night-mode');
        }

        function drawSVGBg() {
            const svg = document.getElementById('zodiac-wheel');
            const cx = 100, cy = 100, r = 90;
            const symbols = ["â™ˆ","â™‰","â™Š","â™‹","â™Œ","â™","â™","â™","â™","â™‘","â™’","â™“"];
            
            // ç»˜åˆ¶åº•åœ†
            let html = `<circle cx="100" cy="100" r="${r}" fill="none" stroke="rgba(255,255,255,0.3)" stroke-width="1" />`;
            
            // ç»˜åˆ¶12å®«åˆ†å‰²çº¿å’Œç¬¦å·
            for(let i=0; i<12; i++) {
                const angle = (i * 30) * (Math.PI / 180);
                const x1 = cx + (r-20) * Math.cos(angle);
                const y1 = cy + (r-20) * Math.sin(angle);
                const x2 = cx + r * Math.cos(angle);
                const y2 = cy + r * Math.sin(angle);
                
                // çº¿æ¡
                html += `<line x1="${x1}" y1="${y1}" x2="${x2}" y2="${y2}" stroke="rgba(255,255,255,0.3)" stroke-width="1" />`;
                
                // ç¬¦å· (æ”¾åœ¨æ¯æ ¼ä¸­é—´)
                const textAngle = (i * 30 + 15) * (Math.PI / 180);
                // ä¿®æ­£ SVG åæ ‡ç³»: 0åº¦åœ¨å³è¾¹(3ç‚¹é’Ÿ)ï¼Œé€šå¸¸ç™½ç¾Šåº§åœ¨9ç‚¹æˆ–12ç‚¹ã€‚è¿™é‡Œç®€åŒ–ï¼Œç›´æ¥æŒ‰é¡ºåºæ’åˆ—ã€‚
                const tx = cx + (r - 10) * Math.cos(textAngle);
                const ty = cy + (r - 10) * Math.sin(textAngle);
                
                html += `<text x="${tx}" y="${ty}" fill="${i%2==0 ? '#FFD700':'#FFF'}" font-size="10" text-anchor="middle" dominant-baseline="middle" transform="rotate(${i*30+15+90}, ${tx}, ${ty})">${symbols[i]}</text>`;
            }
            svg.innerHTML = html;
        }

        // --- 3. æ ¸å¿ƒä¸šåŠ¡é€»è¾‘ ---

        document.getElementById('astro-form').addEventListener('submit', async (e) => {
            e.preventDefault();
            const name = document.getElementById('username').value || "User";
            const date = document.getElementById('birthdate').value;
            const time = document.getElementById('birthtime').value;

            if(!date) return alert("Please select date!");

            // UI Loading
            document.getElementById('loader').style.display = 'block';
            document.getElementById('btn-submit').style.display = 'none';

            // æ•°æ®è·å– (API or Mock)
            try {
                const data = await fetchAstroData(date, time);
                userData = { name, ...data }; // å­˜å…¥å…¨å±€
                renderResults();
            } catch (err) {
                console.error(err);
                alert("Connection Error. Using Offline Oracle.");
            } finally {
                document.getElementById('loader').style.display = 'none';
            }
        });

        async function fetchAstroData(dateStr, timeStr) {
            // çœŸå® API é€»è¾‘ç»“æ„
            if (USE_REAL_API) {
                try {
                    // ç¤ºä¾‹ï¼šè¿™é‡Œéœ€è¦çœŸå®çš„ Request Body
                    /* const res = await fetch(API_URL, { 
                        method: 'POST', 
                        body: JSON.stringify({ date: dateStr, time: timeStr, api_key: API_KEY }) 
                    });
                    return await res.json();
                    */
                   throw new Error("Key not configured");
                } catch (e) {
                    console.warn("API fail, fallback mock");
                    return getMockData(dateStr, timeStr);
                }
            } else {
                // æ¨¡æ‹Ÿå»¶è¿Ÿ
                await new Promise(r => setTimeout(r, 1500));
                return getMockData(dateStr, timeStr);
            }
        }

        function getMockData(dateStr, timeStr) {
            const d = new Date(dateStr);
            const m = d.getMonth() + 1;
            const day = d.getDate();
            
            // å¤ªé˜³æ˜Ÿåº§ç®€æ˜“è®¡ç®—
            const sunIdx = getZodiacIndex(m, day);
            
            // æ¨¡æ‹Ÿå…¶ä»–è¡Œæ˜Ÿ (åŸºäºHash)
            const seed = dateStr + (timeStr || "12:00");
            const hash = seed.split('').reduce((a,b)=>a+b.charCodeAt(0),0);
            
            return {
                sun: { index: sunIdx, degree: sunIdx * 30 + 15 },
                moon: { index: (hash+2)%12, degree: Math.random()*360 },
                rising: { index: (hash+7)%12, degree: Math.random()*360 },
                mercury: { index: (sunIdx+1)%12, degree: ((sunIdx+1)%12)*30 + 10 },
                venus: { index: (sunIdx-1+12)%12, degree: ((sunIdx-1+12)%12)*30 + 20 }
            };
        }

        function getZodiacIndex(m, d) {
            const days = [20, 19, 21, 20, 21, 22, 23, 23, 23, 24, 22, 22]; // ç»“æŸæ—¥æœŸ
            // 0=Aquarius start index logic... ä¿®æ­£ä¸ºæ ‡å‡†ï¼š0=Aries (3.21)
            // ç®€åŒ–ç‰ˆï¼š
            // æ‘©ç¾¯(0), æ°´ç“¶(1), åŒé±¼(2), ç™½ç¾Š(3)... 
            // è¿™é‡Œæˆ‘ä»¬ç”¨æ ‡å‡†æ•°ç»„ TRANSLATIONS.cn.zodiacNames (0=ç™½ç¾Š)
            // ç™½ç¾Š 3.21-4.19
            if((m==3 && d>=21) || (m==4 && d<=19)) return 0;
            if((m==4 && d>=20) || (m==5 && d<=20)) return 1;
            if((m==5 && d>=21) || (m==6 && d<=21)) return 2;
            if((m==6 && d>=22) || (m==7 && d<=22)) return 3;
            if((m==7 && d>=23) || (m==8 && d<=22)) return 4;
            if((m==8 && d>=23) || (m==9 && d<=22)) return 5;
            if((m==9 && d>=23) || (m==10 && d<=23)) return 6;
            if((m==10 && d>=24) || (m==11 && d<=22)) return 7;
            if((m==11 && d>=23) || (m==12 && d<=21)) return 8;
            if((m==12 && d>=22) || (m==1 && d<=19)) return 9; // Cap
            if((m==1 && d>=20) || (m==2 && d<=18)) return 10;
            return 11; // Pisces
        }

        // 4. æ¸²æŸ“ç»“æœ
        function renderResults() {
            const t = TRANSLATIONS[currentLang];
            const signs = t.zodiacNames;

            // æ–‡æœ¬å¡«å……
            document.getElementById('input-card').style.display = 'none';
            document.querySelector('header').style.display = 'none'; // ç®€åŒ–ç•Œé¢
            document.getElementById('result-section').style.display = 'block';
            setTimeout(()=>document.getElementById('result-section').classList.add('fade-in'), 50);

            document.getElementById('res-name-display').textContent = userData.name;
            
            // å¡«å……ä¸‰å®«
            const sName = signs[userData.sun.index];
            const mName = signs[userData.moon.index];
            const rName = signs[userData.rising.index];

            document.getElementById('val-sun').textContent = sName;
            document.getElementById('desc-sun').textContent = currentLang === 'cn' ? "ä½ çš„æ ¸å¿ƒè‡ªæˆ‘ä¸ç”Ÿå‘½ç›®æ ‡ã€‚" : "Your core ego and life purpose.";
            
            document.getElementById('val-moon').textContent = mName;
            document.getElementById('desc-moon').textContent = currentLang === 'cn' ? "ä½ çš„æƒ…æ„Ÿéœ€æ±‚ä¸æ½œæ„è¯†ã€‚" : "Your emotional needs and subconscious.";
            
            document.getElementById('val-rising').textContent = rName;
            document.getElementById('desc-rising').textContent = currentLang === 'cn' ? "ä½ çš„é¢å…·ä¸ä»–äººç¬¬ä¸€å°è±¡ã€‚" : "Your social mask and first impressions.";

            // æ”¾ç½®è¡Œæ˜Ÿ (Visualization)
            const layer = document.getElementById('planet-layer');
            layer.innerHTML = '';
            
            addPlanet(layer, 'sun', 'â˜€ï¸', userData.sun.degree, sName, currentLang==='cn'?"æ ¸å¿ƒèƒ½é‡":"Core Energy");
            addPlanet(layer, 'moon', 'ğŸŒ™', userData.moon.degree, mName, currentLang==='cn'?"æƒ…ç»ªå®‰å…¨æ„Ÿ":"Emotions");
            addPlanet(layer, 'rising', 'ğŸ¹', userData.rising.degree, rName, currentLang==='cn'?"äººæ ¼é¢å…·":"Persona");
            addPlanet(layer, 'mercury', 'â˜¿ï¸', userData.mercury.degree, signs[userData.mercury.index], "Communication");
            addPlanet(layer, 'venus', 'â™€ï¸', userData.venus.degree, signs[userData.venus.index], "Love & Values");
        }

        function addPlanet(container, type, iconChar, degree, sign, desc) {
            const marker = document.createElement('div');
            marker.className = 'planet-marker';
            marker.style.transform = `rotate(${degree}deg)`; // æ—‹è½¬è§’åº¦å®šä½

            const icon = document.createElement('div');
            icon.className = 'planet-icon';
            icon.innerHTML = iconChar;
            icon.style.transform = `rotate(-${degree}deg)`; // åå‘æ—‹è½¬ä¿æŒå›¾æ ‡ç›´ç«‹
            
            // Tooltip
            const tip = document.createElement('div');
            tip.className = 'astro-tooltip';
            tip.innerHTML = `<strong>${type.toUpperCase()} in ${sign}</strong><br>${desc}`;
            
            icon.appendChild(tip);
            marker.appendChild(icon);
            container.appendChild(marker);
        }

        // --- 5. Premium åŠŸèƒ½ ---
        function unlockPremium() {
            alert(currentLang === 'cn' ? "æ¨¡æ‹Ÿæ”¯ä»˜æˆåŠŸï¼æ¬¢è¿å°Šè´µçš„ä¼šå‘˜ã€‚" : "Payment Mock Success! Welcome Premium User.");
            
            document.getElementById('lock-overlay').style.display = 'none';
            document.querySelector('.blur-preview').style.display = 'none';
            document.getElementById('premium-content').style.display = 'block';

            // ç”Ÿæˆè¿åŠ¿æ–‡æ¡ˆ
            const t = TRANSLATIONS[currentLang];
            const signs = t.zodiacNames;
            // ç®€å•é€»è¾‘ï¼šæ­£ç¼˜æ˜¯é‡‘æ˜Ÿçš„ä¸‹ä¸€ä¸ªæ˜Ÿåº§
            const loveSign = signs[(userData.venus.index + 1) % 12];
            const month = Math.floor(Math.random() * 12) + 1;
            
            const textCN = `æ ¹æ®ä½ çš„æ˜Ÿç›˜ï¼Œ2026å¹´ä½ çš„æ¡ƒèŠ±è¿å°†åœ¨ <strong>${month}æœˆ</strong> è¾¾åˆ°å·…å³°ã€‚ä½ çš„æ­£ç¼˜ææœ‰å¯èƒ½æ˜¯ <strong>${loveSign}</strong>ï¼Œå¯¹æ–¹ç‰¹è´¨ï¼šæˆç†Ÿç¨³é‡ï¼Œä½†åœ¨æ„Ÿæƒ…ä¸­ç•¥æ˜¾è¢«åŠ¨ã€‚å»ºè®®å¤šå‚åŠ èŒåœºç¤¾äº¤æˆ–è€å‹èšä¼šã€‚`;
            const textEN = `Based on your Venus placement, your love luck peaks in <strong>Month ${month}</strong>, 2026. Your soulmate is likely a <strong>${loveSign}</strong>. Traits: Grounded but shy. Look out for connections at work.`;

            document.getElementById('love-forecast-text').innerHTML = currentLang === 'cn' ? textCN : textEN;
        }

        function calcMatch() {
            const pDate = document.getElementById('partner-date').value;
            if(!pDate) return alert("Select Date");
            const score = Math.floor(Math.random() * 40) + 60; // 60-100
            const el = document.getElementById('match-result');
            if(currentLang === 'cn') {
                el.innerHTML = `åŒ¹é…åº¦ï¼š<span style="color:#ff00cc; font-size:1.2rem;">${score}%</span><br>${score>85?'çµé­‚ä¼´ä¾£ï¼':'è¿˜éœ€è¦ç£¨åˆå“¦ã€‚'}`;
            } else {
                el.innerHTML = `Compatibility: <span style="color:#ff00cc; font-size:1.2rem;">${score}%</span><br>${score>85?'Soulmates!':'Needs work.'}`;
            }
        }

        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // âš ï¸ PDF åªèƒ½æ˜¾ç¤ºè‹±æ–‡ (é™¤éåŠ è½½ base64 å­—ä½“æ–‡ä»¶)
            // æ‰€ä»¥è¿™é‡Œå³ä½¿åœ¨ä¸­æ–‡æ¨¡å¼ä¹Ÿè¾“å‡ºè‹±æ–‡æŠ¥å‘Šï¼Œæˆ–è€…è½¬å†™
            
            doc.setFont("helvetica", "bold");
            doc.setFontSize(22);
            doc.text("Cosmic Soul Report 2026", 20, 20);
            
            doc.setFontSize(14);
            doc.setFont("helvetica", "normal");
            doc.text(`Name: ${userData.name}`, 20, 40);
            doc.text(`Sun Sign: ${document.getElementById('val-sun').textContent} (Calculated)`, 20, 50);
            doc.text(`Moon Sign: ${document.getElementById('val-moon').textContent}`, 20, 60);
            doc.text(`Rising Sign: ${document.getElementById('val-rising').textContent}`, 20, 70);
            
            doc.setLineWidth(0.5);
            doc.line(20, 80, 190, 80);
            
            doc.setFontSize(16);
            doc.text("Premium Insights", 20, 95);
            
            doc.setFontSize(12);
            const loveText = document.getElementById('love-forecast-text').innerText;
            // ç®€å•çš„æ­£åˆ™æ›¿æ¢ç§»é™¤ä¸­æ–‡ï¼Œæˆ–è€…å†™æ­»è‹±æ–‡ Fallback
            const pdfBody = currentLang === 'cn' 
                ? "Note: Full Chinese character support requires font loading.\nYour love luck peaks this year. Your potential partner is likely stable and grounded." 
                : loveText;
                
            const splitText = doc.splitTextToSize(pdfBody, 170);
            doc.text(splitText, 20, 105);
            
            doc.save("Astro_Report_2026.pdf");
        }
    </script>
</body>
</html>
